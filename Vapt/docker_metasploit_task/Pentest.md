# Pentest - Metasploit

---------------------------

## CHECKLIST
- [ ] Information Gathering
	- [x] Network scan
	- [x] Identify web server, technologies and database
	- [x] Vulnerable versions
- [ ] Exploiting the Various ports
	- [x] Port 21
	- [ ] Port 25
	- [ ] Port 80
---------------------------

### Information Gathering

I ran the metasploit framework on docker using `sudo docker run --rm -it -p 80:8080 peakkk/metasploitable`

ip address > `172.17.0.2`

First off let's do an nmap scan 

![nmap](images/nmap_scan.png)

Finding the ports available and their uses, we can find the versions that are being used using the `-sV` nmap switch

![nmap version scan](images/nmap_version_scan.png)

### Web Server and technologies

The Following web technologies were discovered

![whatweb discovery](images/whatweb.png)

We find that the server is an _ubuntu linux_ server running _Apache v2.2.8_, title is _Metasploitable2 - Linux_

### Vulnerable versions

From the version scan run, we can identify the vulnerable versions that are being run by the service using `searchsploit`
```
PORT      STATE SERVICE     VERSION

1099/tcp  open  java-rmi    GNU Classpath grmiregistry
2121/tcp  open  ftp         ProFTPD 1.3.1
3306/tcp  open  mysql       MySQL 5.0.51a-3ubuntu5
5900/tcp  open  vnc         VNC (protocol 3.3)
6667/tcp  open  irc         UnrealIRCd (Admin email admin@Metasploitable.LAN)
6697/tcp  open  irc         UnrealIRCd
8180/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
8787/tcp  open  drb         Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)
```
1. Port 21 - ftp - vsftpd 2.3.4
![Port 21 searchsploit](images/port21.png)

2. Port 22 - ssh - OpenSSH 4.7p1 Debian 8ubuntu1
![Port 22 searchsploit](images/port22.png)

3. Port 23 - telnet - Linux telnetd
![port 23 searchsploit](images/port23.png)

4. Port 80 - http - Apache httpd 2.2.8 ((Ubuntu) DAV/2)
![Port 80 searchsploit](images/port80.png)

5. Port 139 & Port 445- netbios-ssn - Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
![Port 139 searchsploit](images/port139A.png)
![Port 139 searchsploit](images/port139B.png)

6. Port 514 - shell - Netapp ONTAP rshd
![Port 514 searchsploit](images/port514.png)

7. Port 1099 - java rmi - GNU Classpath grmiregistry
![Port 1099 searchsploit](images/port1099.png)

8. Port 2121 - ftp - ProFTPD 1.3.1
![Port 2121 searchsploit](images/port2121.png)

9. Port 3306 - mysql - MySQL 5.0.51a-3ubuntu5
![Port 3306 searchsploit](images/port3306.png)

10. Port 5900 - vnc - VNC (protocol 3.3)
![Port 5900 searchsploit](images/port5900.png)

11. Port 6667 && Port 6697- irc - UnrealIRCd (Admin email admin@Metasploitable.LAN)
![Port 6667 searchsploit](images/port6667.png)

12. Port 8180 - http - Apache Tomcat/Coyote JSP engine 1.1
![Port 8180 searchsploit](images/port8180.png)

13. Port 8787 - drb - Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)
![Port 8787 searchsploit](images/port8787.png)

---------------------------------------------------------

### Exploitation

After carrying out the nmap scan, finding open ports, identifying the different vulnerablities for the versions, next up is exploitation; finding out how secure the services running in the ports are.


##### Port 21
First up is **port 21**, ftp.

We will be using metasploit

Within metasplot framework, we can run an nmap service as well to check on the services running and versions in port 21
![](images/msf_nmap.png)

Within msf we can search for modules that we can use to exploit ftp
![](images/msf1.png)

We can use the auxiliary module for ftp is `auxiliary/scanner/ftp/ftp_version`

Set the RHOSTS and the LHOSTS then show options
![](images/msf2.png)

There is an ftp server present ie `vsftpd 2.3.4`. Use searchsploit to do a search in exploitDB to find exploits we can use;
![Port 21 searchsploit](images/port21.png)

From the above, there is a backdoor command execution exploit for the available version that's being used.
![](images/msf3.png)

Use the above exploit, confirm everything is okay then run the exploit
![](images/msf4.png)

We now have an active session running which can be sent to the background using `Ctr+z`
![](images/msf5.png)

use hashdump module to get users and their passwords, set the SESSION the same as the session running in the background then run
![](images/msf6.png)
![](images/msf7.png)

Use the `loot` command to see the results for the exploit just run.
![](images/msf8.png)

Use `John the Ripper` to crack the files and the --show command to view the results/
![](images/msf9.png)

##### Port 25

Use nmap scan in msf to identify the version running and services.
![](images/smtp1.png)
![](images/smtp2.png)

We can search for modules we can use using msf and we get an auxiliary module that we can use, ie, `auxiliary/scanner/smtp/smtp_version` , and can be used for SMTP banner grabbing.

Run the above module and then `services -p 25`
![](images/smtp3.png)

We can do user enumeration for SMTP
![](images/smtp4.png)

This scan could take a while but produces a list of users available.
![](images/smtp5.png)

Basic [smtp commands](https://www.ibm.com/docs/en/zos/2.3.0?topic=set-smtp-commands)


